<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mars Mission | Command Center</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="data:,">
</head>
<body>
    <div id="container">
        <!-- 3D Canvas -->
        <div id="canvas-container"></div>
        
        <!-- UI Overlay: Grid Layout -->
        <div id="ui-overlay">
            <!-- 1. Top Bar -->
            <header id="header">
                <div class="brand">
                    <h1>MARS MISSION <span class="brand-version">V1.0</span></h1>
                </div>
                <div class="header-right">
                    <div id="connection-status" class="status-indicator">
                        <span class="status-dot"></span>
                        <span class="status-text">System Offline</span>
                    </div>
                    <button id="btn-hud" class="btn-icon btn-icon--small" type="button" title="Toggle HUD (H)" aria-pressed="false">HUD</button>
                </div>
            </header>

            <!-- 2. Left Panel: Mission Intelligence -->
            <aside id="left-panel" class="glass-panel">
                <div class="panel-header panel-header--with-actions">
                    <h3>Mission Intelligence</h3>
                    <button id="btn-left-panel" class="panel-toggle" type="button" aria-expanded="true" title="Toggle Mission panel">◂</button>
                </div>
                
                <div class="data-item">
                    <div class="data-label">Current Phase</div>
                    <div id="phase-badge" class="phase-badge">Detecting...</div>
                </div>

                <div class="data-item">
                    <div class="data-label">Mission Progress</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="mission-progress"></div>
                        </div>
                    </div>
                </div>

                <div class="data-item">
                    <div class="data-label">Earth-Mars Distance</div>
                    <div id="earth-mars-dist" class="data-value">0.000 AU</div>
                </div>

                <div class="data-item divider">
                    <div class="data-label">Telemetry (AU)</div>
                    <div class="data-row">
                        <span class="label earth">Earth</span>
                        <span id="earth-pos" class="data-value coord">(0.00, 0.00, 0.00)</span>
                    </div>
                    <div class="data-row">
                        <span class="label mars">Mars</span>
                        <span id="mars-pos" class="data-value coord">(0.00, 0.00, 0.00)</span>
                    </div>
                </div>
            </aside>

            <!-- 3. Right Panel: Craft Telemetry -->
            <aside id="right-panel" class="glass-panel">
                <div class="panel-header panel-header--with-actions">
                    <h3>Craft Telemetry</h3>
                    <button id="btn-right-panel" class="panel-toggle" type="button" aria-expanded="true"
                        title="Toggle Telemetry panel">▸</button>
                </div>
            
                <div class="data-item">
                    <div class="data-label">Craft Position (AU)</div>
                    <div id="ship-pos" class="data-value coord highlight">(0.00, 0.00, 0.00)</div>
                </div>
            
                <div class="data-item">
                    <div class="data-label">Environmental Velocity</div>
                    <div class="data-row">
                        <span class="label">Earth Rel</span>
                        <span id="earth-vel" class="data-value">0.0000</span>
                    </div>
                    <div class="data-row">
                        <span class="label">Mars Rel</span>
                        <span id="mars-vel" class="data-value danger">0.0000</span>
                    </div>
                </div>
            
                <div class="data-item divider">
                    <div class="data-label">Camera Interface</div>
                    <select id="view-mode">
                        <option value="free">Tactical: Free Camera</option>
                        <option value="earth">Focus: Earth Orbit</option>
                        <option value="mars">Focus: Mars Orbit</option>
                        <option value="spacecraft">Focus: Spacecraft</option>
                        <option value="top">Orrery: Top Down</option>
                    </select>
                </div>
            
                <div id="model-calibration" class="data-item divider">
                    <div class="data-label">Model Calibration</div>
                    <div class="calibration-row">
                        <span class="label">Yaw</span>
                        <input id="calib-yaw" type="range" min="-180" max="180" step="1" value="0" class="range--compact" aria-label="Model yaw (degrees)">
                        <span id="calib-yaw-value" class="data-value">0°</span>
                    </div>
            
                    <div class="calibration-row">
                        <span class="label">Pitch</span>
                        <input id="calib-pitch" type="range" min="-180" max="180" step="1" value="0" class="range--compact" aria-label="Model pitch (degrees)">
                        <span id="calib-pitch-value" class="data-value">0°</span>
                    </div>
            
                    <div class="calibration-row">
                        <span class="label">Roll</span>
                        <input id="calib-roll" type="range" min="-180" max="180" step="1" value="0" class="range--compact" aria-label="Model roll (degrees)">
                        <span id="calib-roll-value" class="data-value">0°</span>
                    </div>           
                </div>

                <div id="legend" class="data-item divider">
                    <div class="data-label">Visual Legend</div>
                    <div class="legend-list">
                        <div class="legend-item">
                            <span class="legend-dot sun"></span> Sun
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot earth"></span> Earth
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot mars"></span> Mars
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 4. Bottom Center: Cinema Bar -->
            <footer id="bottom-bar" class="glass-panel">
                <div class="playback-group">
                    <button id="btn-start" class="btn-icon" title="Start">▶</button>
                    <button id="btn-pause" class="btn-icon" title="Pause">⏸</button>
                    <button id="btn-stop" class="btn-icon" title="Reset">⏹</button>
                </div>

                <div class="timeline-container" id="timeline-container">
                    <div class="timeline-info">
                        <span>T+ Day <span id="current-day">0</span></span>
                        <span>Horizon Limit: <span id="total-days">0</span> Days</span>
                    </div>
                    <div class="timeline-track">
                        <input type="range" id="timeline" min="0" max="1000" step="1" value="0" aria-label="Mission timeline">
                        <div id="timeline-markers" class="timeline-markers" aria-hidden="true"></div>
                        <div id="timeline-tooltip" class="timeline-tooltip" aria-hidden="true"></div>
                    </div>
                </div>

                <div class="view-select-container">
                    <div class="data-label compact">Warp</div>
                    <span id="speed-value" class="mono value-compact">0.5</span>
                    <input type="range" id="time-speed" class="range--compact" min="0.1" max="5" step="0.1" value="0.5">
                </div>
            </footer>

            <!-- 5. Utility -->
            <button id="info-btn" class="btn-icon info-btn-fixed" title="Info" aria-haspopup="dialog" aria-controls="info-modal">?</button>
        </div>
        
        <!-- Modal -->
        <div id="info-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
            <div class="modal-content glass-panel">
                <button class="close" type="button" aria-label="Close">&times;</button>
                <h2 id="modal-title" class="modal-title">Mission Parameters</h2>
                <div class="modal-body">
                    <p>Dynamic 3D Hohmann Transfer simulation.</p>
                    <ul class="modal-list">
                        <li><strong class="text-strong">Phase 1:</strong> Earth to Mars (Prograde Ellipse)</li>
                        <li><strong class="text-strong">Phase 2:</strong> Mars Surface Operations</li>
                        <li><strong class="text-strong">Phase 3:</strong> Return to Earth</li>
                    </ul>
                    <p class="modal-footer">Interactive visualization powered by Three.js and FastAPI.</p>
                </div>
            </div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE_NS from 'three';

        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { SSAARenderPass } from 'three/addons/postprocessing/SSAARenderPass.js';
        import { SMAAPass } from 'three/addons/postprocessing/SMAAPass.js';
        import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';

        const THREE = { ...THREE_NS };

        THREE.OrbitControls = OrbitControls;
        THREE.GLTFLoader = GLTFLoader;
        THREE.RGBELoader = RGBELoader;
        THREE.RoomEnvironment = RoomEnvironment;

        THREE.EffectComposer = EffectComposer;
        THREE.RenderPass = RenderPass;
        THREE.ShaderPass = ShaderPass;
        THREE.UnrealBloomPass = UnrealBloomPass;
        THREE.SSAARenderPass = SSAARenderPass;
        THREE.SMAAPass = SMAAPass;
        THREE.OutputPass = OutputPass;

        window.THREE = THREE;
    </script>

    <script defer src="/static/spacecraft.js?v=12"></script>
    <script defer src="/static/orbit.js"></script>
    <script defer src="/static/main.js?v=12"></script>
    <script defer src="/static/controls.js"></script>
    <script defer src="/static/ui.js"></script>
</body>
</html>
